{
    "sourceFile": "src/pages/permission/resources/components/ResourceForm.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 19,
            "patches": [
                {
                    "date": 1746087949853,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1746087962142,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,13 +76,9 @@\n       onCancel={onCancel}\r\n       onOk={handleSubmit}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n-      <Form\r\n-        form={form}\r\n-        layout=\"vertical\"\r\n-        initialValues={{ status: true }}\r\n-      >\r\n+      <Form form={form} layout=\"vertical\" initialValues={{ status: true }}>\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"资源名称\"\r\n           rules={[{ required: true, message: \"请输入资源名称\" }]}\r\n@@ -125,9 +121,10 @@\n           name=\"method\"\r\n           label=\"请求方法\"\r\n           rules={[\r\n             {\r\n-              required: (form) => form.getFieldValue(\"type\") === ResourceType.API,\r\n+              required: (form) =>\r\n+                form.getFieldValue(\"type\") === ResourceType.API,\r\n               message: \"请选择请求方法\",\r\n             },\r\n           ]}\r\n         >\r\n@@ -146,9 +143,12 @@\n           <Input placeholder=\"请输入图标\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"parentId\" label=\"父级资源\">\r\n-          <InputNumber placeholder=\"请输入父级资源ID\" style={{ width: \"100%\" }} />\r\n+          <InputNumber\r\n+            placeholder=\"请输入父级资源ID\"\r\n+            style={{ width: \"100%\" }}\r\n+          />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"sort\" label=\"排序\">\r\n           <InputNumber placeholder=\"请输入排序\" style={{ width: \"100%\" }} />\r\n@@ -161,5 +161,5 @@\n     </Modal>\r\n   );\r\n };\r\n \r\n-export default ResourceForm; \n\\ No newline at end of file\n+export default ResourceForm;\r\n"
                },
                {
                    "date": 1746087995918,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,12 @@\n import { Form, Input, InputNumber, Modal, Select, Switch } from \"antd\";\r\n+import type { ICreateResourceParams, IResource, IUpdateResourceParams } from \"@/types/api/resource\";\r\n import { createResource, updateResource } from \"@/api/modules/resource\";\r\n-import { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\r\n \r\n-import type { IResource } from \"@/types/api/resource\";\r\n import { ResourceType } from \"@/types/api/resource\";\r\n import { message } from \"antd\";\r\n import { useEffect } from \"react\";\r\n+import { useMutation } from \"@tanstack/react-query\";\r\n \r\n interface IResourceFormProps {\r\n   visible: boolean;\r\n   editingResource: IResource | null;\r\n@@ -19,23 +19,22 @@\n   editingResource,\r\n   onCancel,\r\n   onSuccess,\r\n }: IResourceFormProps) => {\r\n-  const [form] = Form.useForm();\r\n-  const queryClient = useQueryClient();\r\n+  const [form] = Form.useForm<ICreateResourceParams>();\r\n \r\n   // 创建资源\r\n   const createMutation = useMutation({\r\n-    mutationFn: createResource,\r\n+    mutationFn: (data: ICreateResourceParams) => createResource(data),\r\n     onSuccess: () => {\r\n       message.success(\"创建成功\");\r\n       onSuccess();\r\n     },\r\n   });\r\n \r\n   // 更新资源\r\n   const updateMutation = useMutation({\r\n-    mutationFn: updateResource,\r\n+    mutationFn: ({ id, ...data }: IUpdateResourceParams & { id: number }) => updateResource(id, data),\r\n     onSuccess: () => {\r\n       message.success(\"更新成功\");\r\n       onSuccess();\r\n     },\r\n@@ -76,9 +75,13 @@\n       onCancel={onCancel}\r\n       onOk={handleSubmit}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n-      <Form form={form} layout=\"vertical\" initialValues={{ status: true }}>\r\n+      <Form\r\n+        form={form}\r\n+        layout=\"vertical\"\r\n+        initialValues={{ status: true }}\r\n+      >\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"资源名称\"\r\n           rules={[{ required: true, message: \"请输入资源名称\" }]}\r\n@@ -121,11 +124,13 @@\n           name=\"method\"\r\n           label=\"请求方法\"\r\n           rules={[\r\n             {\r\n-              required: (form) =>\r\n-                form.getFieldValue(\"type\") === ResourceType.API,\r\n-              message: \"请选择请求方法\",\r\n+              validator: async (_, value) => {\r\n+                if (form.getFieldValue(\"type\") === ResourceType.API && !value) {\r\n+                  throw new Error(\"请选择请求方法\");\r\n+                }\r\n+              },\r\n             },\r\n           ]}\r\n         >\r\n           <Select\r\n@@ -143,12 +148,9 @@\n           <Input placeholder=\"请输入图标\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"parentId\" label=\"父级资源\">\r\n-          <InputNumber\r\n-            placeholder=\"请输入父级资源ID\"\r\n-            style={{ width: \"100%\" }}\r\n-          />\r\n+          <InputNumber placeholder=\"请输入父级资源ID\" style={{ width: \"100%\" }} />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"sort\" label=\"排序\">\r\n           <InputNumber placeholder=\"请输入排序\" style={{ width: \"100%\" }} />\r\n"
                },
                {
                    "date": 1746088927447,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,10 @@\n import { Form, Input, InputNumber, Modal, Select, Switch } from \"antd\";\r\n-import type { ICreateResourceParams, IResource, IUpdateResourceParams } from \"@/types/api/resource\";\r\n+import type {\r\n+  ICreateResourceParams,\r\n+  IResource,\r\n+  IUpdateResourceParams,\r\n+} from \"@/types/api/resource\";\r\n import { createResource, updateResource } from \"@/api/modules/resource\";\r\n \r\n import { ResourceType } from \"@/types/api/resource\";\r\n import { message } from \"antd\";\r\n@@ -32,9 +36,10 @@\n   });\r\n \r\n   // 更新资源\r\n   const updateMutation = useMutation({\r\n-    mutationFn: ({ id, ...data }: IUpdateResourceParams & { id: number }) => updateResource(id, data),\r\n+    mutationFn: ({ id, ...data }: IUpdateResourceParams & { id: number }) =>\r\n+      updateResource(id, data),\r\n     onSuccess: () => {\r\n       message.success(\"更新成功\");\r\n       onSuccess();\r\n     },\r\n@@ -75,13 +80,9 @@\n       onCancel={onCancel}\r\n       onOk={handleSubmit}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n-      <Form\r\n-        form={form}\r\n-        layout=\"vertical\"\r\n-        initialValues={{ status: true }}\r\n-      >\r\n+      <Form form={form} layout=\"vertical\" initialValues={{ status: true }}>\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"资源名称\"\r\n           rules={[{ required: true, message: \"请输入资源名称\" }]}\r\n@@ -148,9 +149,12 @@\n           <Input placeholder=\"请输入图标\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"parentId\" label=\"父级资源\">\r\n-          <InputNumber placeholder=\"请输入父级资源ID\" style={{ width: \"100%\" }} />\r\n+          <InputNumber\r\n+            placeholder=\"请输入父级资源ID\"\r\n+            style={{ width: \"100%\" }}\r\n+          />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"sort\" label=\"排序\">\r\n           <InputNumber placeholder=\"请输入排序\" style={{ width: \"100%\" }} />\r\n"
                },
                {
                    "date": 1746097782514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,14 +1,13 @@\n-import { Form, Input, InputNumber, Modal, Select, Switch } from \"antd\";\r\n+import { Form, Input, InputNumber, Modal, Select, Switch, message } from \"antd\";\r\n import type {\r\n   ICreateResourceParams,\r\n   IResource,\r\n   IUpdateResourceParams,\r\n+  ResourceType,\r\n } from \"@/types/api/resource\";\r\n import { createResource, updateResource } from \"@/api/modules/resource\";\r\n \r\n-import { ResourceType } from \"@/types/api/resource\";\r\n-import { message } from \"antd\";\r\n import { useEffect } from \"react\";\r\n import { useMutation } from \"@tanstack/react-query\";\r\n \r\n interface IResourceFormProps {\r\n@@ -17,14 +16,14 @@\n   onCancel: () => void;\r\n   onSuccess: () => void;\r\n }\r\n \r\n-const ResourceForm = ({\r\n+const ResourceForm: React.FC<IResourceFormProps> = ({\r\n   visible,\r\n   editingResource,\r\n   onCancel,\r\n   onSuccess,\r\n-}: IResourceFormProps) => {\r\n+}) => {\r\n   const [form] = Form.useForm<ICreateResourceParams>();\r\n \r\n   // 创建资源\r\n   const createMutation = useMutation({\r\n@@ -36,17 +35,17 @@\n   });\r\n \r\n   // 更新资源\r\n   const updateMutation = useMutation({\r\n-    mutationFn: ({ id, ...data }: IUpdateResourceParams & { id: number }) =>\r\n+    mutationFn: ({ id, data }: { id: number; data: IUpdateResourceParams }) =>\r\n       updateResource(id, data),\r\n     onSuccess: () => {\r\n       message.success(\"更新成功\");\r\n       onSuccess();\r\n     },\r\n   });\r\n \r\n-  // 监听表单显示状态\r\n+  // 监听表单可见性变化\r\n   useEffect(() => {\r\n     if (visible) {\r\n       if (editingResource) {\r\n         form.setFieldsValue(editingResource);\r\n@@ -62,15 +61,16 @@\n       const values = await form.validateFields();\r\n       if (editingResource) {\r\n         updateMutation.mutate({\r\n           id: editingResource.id,\r\n-          ...values,\r\n+          data: values,\r\n         });\r\n       } else {\r\n         createMutation.mutate(values);\r\n       }\r\n     } catch (error) {\r\n-      console.error(\"表单验证失败:\", error);\r\n+      // 表单验证失败\r\n+      console.error(\"Validate Failed:\", error);\r\n     }\r\n   };\r\n \r\n   return (\r\n@@ -80,9 +80,13 @@\n       onCancel={onCancel}\r\n       onOk={handleSubmit}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n-      <Form form={form} layout=\"vertical\" initialValues={{ status: true }}>\r\n+      <Form<ICreateResourceParams>\r\n+        form={form}\r\n+        layout=\"vertical\"\r\n+        initialValues={{ status: 1 }}\r\n+      >\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"资源名称\"\r\n           rules={[{ required: true, message: \"请输入资源名称\" }]}\r\n@@ -159,10 +163,20 @@\n         <Form.Item name=\"sort\" label=\"排序\">\r\n           <InputNumber placeholder=\"请输入排序\" style={{ width: \"100%\" }} />\r\n         </Form.Item>\r\n \r\n-        <Form.Item name=\"status\" label=\"状态\" valuePropName=\"checked\">\r\n-          <Switch checkedChildren=\"启用\" unCheckedChildren=\"禁用\" />\r\n+        <Form.Item\r\n+          name=\"status\"\r\n+          label=\"状态\"\r\n+          rules={[{ required: true, message: \"请选择状态\" }]}\r\n+        >\r\n+          <Select\r\n+            placeholder=\"请选择状态\"\r\n+            options={[\r\n+              { label: \"启用\", value: 1 },\r\n+              { label: \"禁用\", value: 0 },\r\n+            ]}\r\n+          />\r\n         </Form.Item>\r\n       </Form>\r\n     </Modal>\r\n   );\r\n"
                },
                {
                    "date": 1746097793942,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import { Form, Input, InputNumber, Modal, Select, Switch, message } from \"antd\";\r\n+import { Form, Input, InputNumber, Modal, Select, message } from \"antd\";\r\n import type {\r\n   ICreateResourceParams,\r\n   IResource,\r\n   IUpdateResourceParams,\r\n"
                },
                {
                    "date": 1746097806146,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,12 +2,12 @@\n import type {\r\n   ICreateResourceParams,\r\n   IResource,\r\n   IUpdateResourceParams,\r\n-  ResourceType,\r\n } from \"@/types/api/resource\";\r\n import { createResource, updateResource } from \"@/api/modules/resource\";\r\n \r\n+import { ResourceType } from \"@/types/api/resource\";\r\n import { useEffect } from \"react\";\r\n import { useMutation } from \"@tanstack/react-query\";\r\n \r\n interface IResourceFormProps {\r\n"
                },
                {
                    "date": 1746150033214,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -162,22 +162,8 @@\n \r\n         <Form.Item name=\"sort\" label=\"排序\">\r\n           <InputNumber placeholder=\"请输入排序\" style={{ width: \"100%\" }} />\r\n         </Form.Item>\r\n-\r\n-        <Form.Item\r\n-          name=\"status\"\r\n-          label=\"状态\"\r\n-          rules={[{ required: true, message: \"请选择状态\" }]}\r\n-        >\r\n-          <Select\r\n-            placeholder=\"请选择状态\"\r\n-            options={[\r\n-              { label: \"启用\", value: 1 },\r\n-              { label: \"禁用\", value: 0 },\r\n-            ]}\r\n-          />\r\n-        </Form.Item>\r\n       </Form>\r\n     </Modal>\r\n   );\r\n };\r\n"
                },
                {
                    "date": 1746150042873,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -83,9 +83,8 @@\n     >\r\n       <Form<ICreateResourceParams>\r\n         form={form}\r\n         layout=\"vertical\"\r\n-        initialValues={{ status: 1 }}\r\n       >\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"资源名称\"\r\n"
                },
                {
                    "date": 1746156548795,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,10 +35,10 @@\n   });\r\n \r\n   // 更新资源\r\n   const updateMutation = useMutation({\r\n-    mutationFn: ({ id, data }: { id: number; data: IUpdateResourceParams }) =>\r\n-      updateResource(id, data),\r\n+    mutationFn: (params: { id: number; data: IUpdateResourceParams }) =>\r\n+      updateResource(params.id, params.data),\r\n     onSuccess: () => {\r\n       message.success(\"更新成功\");\r\n       onSuccess();\r\n     },\r\n@@ -58,9 +58,9 @@\n   // 处理表单提交\r\n   const handleSubmit = async () => {\r\n     try {\r\n       const values = await form.validateFields();\r\n-      if (editingResource) {\r\n+      if (editingResource?.id) {\r\n         updateMutation.mutate({\r\n           id: editingResource.id,\r\n           data: values,\r\n         });\r\n"
                },
                {
                    "date": 1746156778621,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,12 +80,9 @@\n       onCancel={onCancel}\r\n       onOk={handleSubmit}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n-      <Form<ICreateResourceParams>\r\n-        form={form}\r\n-        layout=\"vertical\"\r\n-      >\r\n+      <Form<ICreateResourceParams> form={form} layout=\"vertical\">\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"资源名称\"\r\n           rules={[{ required: true, message: \"请输入资源名称\" }]}\r\n"
                },
                {
                    "date": 1746156890647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,43 +107,29 @@\n             placeholder=\"请选择资源类型\"\r\n             options={[\r\n               { label: \"菜单\", value: ResourceType.MENU },\r\n               { label: \"按钮\", value: ResourceType.BUTTON },\r\n-              { label: \"接口\", value: ResourceType.API },\r\n             ]}\r\n           />\r\n         </Form.Item>\r\n \r\n         <Form.Item\r\n           name=\"path\"\r\n-          label=\"资源路径\"\r\n-          rules={[{ required: true, message: \"请输入资源路径\" }]}\r\n-        >\r\n-          <Input placeholder=\"请输入资源路径\" />\r\n-        </Form.Item>\r\n-\r\n-        <Form.Item\r\n-          name=\"method\"\r\n-          label=\"请求方法\"\r\n+          label=\"路由路径\"\r\n           rules={[\r\n             {\r\n               validator: async (_, value) => {\r\n-                if (form.getFieldValue(\"type\") === ResourceType.API && !value) {\r\n-                  throw new Error(\"请选择请求方法\");\r\n+                if (\r\n+                  form.getFieldValue(\"type\") === ResourceType.MENU &&\r\n+                  !value\r\n+                ) {\r\n+                  throw new Error(\"菜单类型必须输入路由路径\");\r\n                 }\r\n               },\r\n             },\r\n           ]}\r\n         >\r\n-          <Select\r\n-            placeholder=\"请选择请求方法\"\r\n-            options={[\r\n-              { label: \"GET\", value: \"GET\" },\r\n-              { label: \"POST\", value: \"POST\" },\r\n-              { label: \"PUT\", value: \"PUT\" },\r\n-              { label: \"DELETE\", value: \"DELETE\" },\r\n-            ]}\r\n-          />\r\n+          <Input placeholder=\"请输入路由路径\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"icon\" label=\"图标\">\r\n           <Input placeholder=\"请输入图标\" />\r\n"
                },
                {
                    "date": 1746157022349,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import { Form, Input, InputNumber, Modal, Select, message } from \"antd\";\r\n+import { Form, Input, InputNumber, Modal, message } from \"antd\";\r\n import type {\r\n   ICreateResourceParams,\r\n   IResource,\r\n   IUpdateResourceParams,\r\n@@ -26,9 +26,13 @@\n   const [form] = Form.useForm<ICreateResourceParams>();\r\n \r\n   // 创建资源\r\n   const createMutation = useMutation({\r\n-    mutationFn: (data: ICreateResourceParams) => createResource(data),\r\n+    mutationFn: (data: ICreateResourceParams) =>\r\n+      createResource({\r\n+        ...data,\r\n+        type: ResourceType.MENU, // 默认为菜单类型\r\n+      }),\r\n     onSuccess: () => {\r\n       message.success(\"创建成功\");\r\n       onSuccess();\r\n     },\r\n@@ -36,9 +40,12 @@\n \r\n   // 更新资源\r\n   const updateMutation = useMutation({\r\n     mutationFn: (params: { id: number; data: IUpdateResourceParams }) =>\r\n-      updateResource(params.id, params.data),\r\n+      updateResource(params.id, {\r\n+        ...params.data,\r\n+        type: ResourceType.MENU, // 确保更新时也是菜单类型\r\n+      }),\r\n     onSuccess: () => {\r\n       message.success(\"更新成功\");\r\n       onSuccess();\r\n     },\r\n@@ -74,71 +81,46 @@\n   };\r\n \r\n   return (\r\n     <Modal\r\n-      title={editingResource ? \"编辑资源\" : \"新增资源\"}\r\n+      title={editingResource ? \"编辑菜单\" : \"新增菜单\"}\r\n       open={visible}\r\n       onCancel={onCancel}\r\n       onOk={handleSubmit}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n       <Form<ICreateResourceParams> form={form} layout=\"vertical\">\r\n         <Form.Item\r\n           name=\"name\"\r\n-          label=\"资源名称\"\r\n-          rules={[{ required: true, message: \"请输入资源名称\" }]}\r\n+          label=\"菜单名称\"\r\n+          rules={[{ required: true, message: \"请输入菜单名称\" }]}\r\n         >\r\n-          <Input placeholder=\"请输入资源名称\" />\r\n+          <Input placeholder=\"请输入菜单名称\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item\r\n           name=\"code\"\r\n-          label=\"资源编码\"\r\n-          rules={[{ required: true, message: \"请输入资源编码\" }]}\r\n+          label=\"菜单编码\"\r\n+          rules={[{ required: true, message: \"请输入菜单编码\" }]}\r\n         >\r\n-          <Input placeholder=\"请输入资源编码\" />\r\n+          <Input placeholder=\"请输入菜单编码\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item\r\n-          name=\"type\"\r\n-          label=\"资源类型\"\r\n-          rules={[{ required: true, message: \"请选择资源类型\" }]}\r\n-        >\r\n-          <Select\r\n-            placeholder=\"请选择资源类型\"\r\n-            options={[\r\n-              { label: \"菜单\", value: ResourceType.MENU },\r\n-              { label: \"按钮\", value: ResourceType.BUTTON },\r\n-            ]}\r\n-          />\r\n-        </Form.Item>\r\n-\r\n-        <Form.Item\r\n           name=\"path\"\r\n           label=\"路由路径\"\r\n-          rules={[\r\n-            {\r\n-              validator: async (_, value) => {\r\n-                if (\r\n-                  form.getFieldValue(\"type\") === ResourceType.MENU &&\r\n-                  !value\r\n-                ) {\r\n-                  throw new Error(\"菜单类型必须输入路由路径\");\r\n-                }\r\n-              },\r\n-            },\r\n-          ]}\r\n+          rules={[{ required: true, message: \"请输入路由路径\" }]}\r\n         >\r\n           <Input placeholder=\"请输入路由路径\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item name=\"icon\" label=\"图标\">\r\n           <Input placeholder=\"请输入图标\" />\r\n         </Form.Item>\r\n \r\n-        <Form.Item name=\"parentId\" label=\"父级资源\">\r\n+        <Form.Item name=\"parentId\" label=\"父级菜单\">\r\n           <InputNumber\r\n-            placeholder=\"请输入父级资源ID\"\r\n+            placeholder=\"请输入父级菜单ID\"\r\n             style={{ width: \"100%\" }}\r\n           />\r\n         </Form.Item>\r\n \r\n"
                },
                {
                    "date": 1746157489883,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,23 @@\n-import { Form, Input, InputNumber, Modal, message } from \"antd\";\r\n+import {\r\n+  ApartmentOutlined,\r\n+  AppstoreOutlined,\r\n+  BarsOutlined,\r\n+  DashboardOutlined,\r\n+  FileTextOutlined,\r\n+  KeyOutlined,\r\n+  ProfileOutlined,\r\n+  ProjectOutlined,\r\n+  SecurityScanOutlined,\r\n+  SettingOutlined,\r\n+  ShopOutlined,\r\n+  SolutionOutlined,\r\n+  TagsOutlined,\r\n+  TeamOutlined,\r\n+  ToolOutlined,\r\n+  UserOutlined,\r\n+} from \"@ant-design/icons\";\r\n+import { Form, Input, Modal, Select, message } from \"antd\";\r\n import type {\r\n   ICreateResourceParams,\r\n   IResource,\r\n   IUpdateResourceParams,\r\n@@ -9,8 +27,32 @@\n import { ResourceType } from \"@/types/api/resource\";\r\n import { useEffect } from \"react\";\r\n import { useMutation } from \"@tanstack/react-query\";\r\n \r\n+// 定义常用的图标列表\r\n+const ICON_OPTIONS = [\r\n+  { label: \"仪表盘\", value: \"DashboardOutlined\", icon: <DashboardOutlined /> },\r\n+  { label: \"应用\", value: \"AppstoreOutlined\", icon: <AppstoreOutlined /> },\r\n+  { label: \"用户\", value: \"UserOutlined\", icon: <UserOutlined /> },\r\n+  { label: \"团队\", value: \"TeamOutlined\", icon: <TeamOutlined /> },\r\n+  { label: \"设置\", value: \"SettingOutlined\", icon: <SettingOutlined /> },\r\n+  {\r\n+    label: \"安全\",\r\n+    value: \"SecurityScanOutlined\",\r\n+    icon: <SecurityScanOutlined />,\r\n+  },\r\n+  { label: \"权限\", value: \"KeyOutlined\", icon: <KeyOutlined /> },\r\n+  { label: \"组织\", value: \"ApartmentOutlined\", icon: <ApartmentOutlined /> },\r\n+  { label: \"列表\", value: \"BarsOutlined\", icon: <BarsOutlined /> },\r\n+  { label: \"文档\", value: \"FileTextOutlined\", icon: <FileTextOutlined /> },\r\n+  { label: \"商品\", value: \"ShopOutlined\", icon: <ShopOutlined /> },\r\n+  { label: \"标签\", value: \"TagsOutlined\", icon: <TagsOutlined /> },\r\n+  { label: \"档案\", value: \"ProfileOutlined\", icon: <ProfileOutlined /> },\r\n+  { label: \"项目\", value: \"ProjectOutlined\", icon: <ProjectOutlined /> },\r\n+  { label: \"方案\", value: \"SolutionOutlined\", icon: <SolutionOutlined /> },\r\n+  { label: \"工具\", value: \"ToolOutlined\", icon: <ToolOutlined /> },\r\n+];\r\n+\r\n interface IResourceFormProps {\r\n   visible: boolean;\r\n   editingResource: IResource | null;\r\n   onCancel: () => void;\r\n@@ -29,9 +71,9 @@\n   const createMutation = useMutation({\r\n     mutationFn: (data: ICreateResourceParams) =>\r\n       createResource({\r\n         ...data,\r\n-        type: ResourceType.MENU, // 默认为菜单类型\r\n+        type: ResourceType.MENU,\r\n       }),\r\n     onSuccess: () => {\r\n       message.success(\"创建成功\");\r\n       onSuccess();\r\n@@ -42,9 +84,9 @@\n   const updateMutation = useMutation({\r\n     mutationFn: (params: { id: number; data: IUpdateResourceParams }) =>\r\n       updateResource(params.id, {\r\n         ...params.data,\r\n-        type: ResourceType.MENU, // 确保更新时也是菜单类型\r\n+        type: ResourceType.MENU,\r\n       }),\r\n     onSuccess: () => {\r\n       message.success(\"更新成功\");\r\n       onSuccess();\r\n@@ -112,21 +154,41 @@\n         >\r\n           <Input placeholder=\"请输入路由路径\" />\r\n         </Form.Item>\r\n \r\n-        <Form.Item name=\"icon\" label=\"图标\">\r\n-          <Input placeholder=\"请输入图标\" />\r\n-        </Form.Item>\r\n-\r\n-        <Form.Item name=\"parentId\" label=\"父级菜单\">\r\n-          <InputNumber\r\n-            placeholder=\"请输入父级菜单ID\"\r\n-            style={{ width: \"100%\" }}\r\n+        <Form.Item\r\n+          name=\"icon\"\r\n+          label=\"图标\"\r\n+          rules={[{ required: true, message: \"请选择图标\" }]}\r\n+        >\r\n+          <Select\r\n+            placeholder=\"请选择图标\"\r\n+            options={ICON_OPTIONS}\r\n+            optionLabelProp=\"label\"\r\n+            optionRender={(option) => (\r\n+              <div style={{ display: \"flex\", alignItems: \"center\", gap: 8 }}>\r\n+                {option.data.icon}\r\n+                <span>{option.data.label}</span>\r\n+              </div>\r\n+            )}\r\n           />\r\n         </Form.Item>\r\n \r\n+        {editingResource?.parentId ? (\r\n+          <Form.Item label=\"父级菜单\">\r\n+            <Input value={editingResource.name} disabled />\r\n+            <Form.Item name=\"parentId\" hidden>\r\n+              <Input />\r\n+            </Form.Item>\r\n+          </Form.Item>\r\n+        ) : (\r\n+          <Form.Item label=\"父级菜单\">\r\n+            <Input value=\"无\" disabled />\r\n+          </Form.Item>\r\n+        )}\r\n+\r\n         <Form.Item name=\"sort\" label=\"排序\">\r\n-          <InputNumber placeholder=\"请输入排序\" style={{ width: \"100%\" }} />\r\n+          <Input type=\"number\" placeholder=\"请输入排序\" />\r\n         </Form.Item>\r\n       </Form>\r\n     </Modal>\r\n   );\r\n"
                },
                {
                    "date": 1746197671809,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -179,8 +179,16 @@\n           <Input placeholder=\"请输入路由路径\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item\r\n+          name=\"componentPath\"\r\n+          label=\"组件路径\"\r\n+          rules={[{ required: true, message: \"请输入组件路径\" }]}\r\n+        >\r\n+          <Input placeholder=\"如：views/dashboard/index 或 @/views/dashboard/index\" />\r\n+        </Form.Item>\r\n+\r\n+        <Form.Item\r\n           name=\"icon\"\r\n           label=\"图标\"\r\n           rules={[{ required: true, message: \"请选择图标\" }]}\r\n         >\r\n"
                },
                {
                    "date": 1746197687419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -179,16 +179,8 @@\n           <Input placeholder=\"请输入路由路径\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item\r\n-          name=\"componentPath\"\r\n-          label=\"组件路径\"\r\n-          rules={[{ required: true, message: \"请输入组件路径\" }]}\r\n-        >\r\n-          <Input placeholder=\"如：views/dashboard/index 或 @/views/dashboard/index\" />\r\n-        </Form.Item>\r\n-\r\n-        <Form.Item\r\n           name=\"icon\"\r\n           label=\"图标\"\r\n           rules={[{ required: true, message: \"请选择图标\" }]}\r\n         >\r\n"
                },
                {
                    "date": 1746197732994,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,13 +21,17 @@\n   ICreateResourceParams,\r\n   IResource,\r\n   IUpdateResourceParams,\r\n } from \"@/types/api/resource\";\r\n-import { createResource, updateResource } from \"@/api/modules/resource\";\r\n+import {\r\n+  createResource,\r\n+  getResource,\r\n+  updateResource,\r\n+} from \"@/api/modules/resource\";\r\n+import { useEffect, useState } from \"react\";\r\n+import { useMutation, useQuery } from \"@tanstack/react-query\";\r\n \r\n import { ResourceType } from \"@/types/api/resource\";\r\n-import { useEffect } from \"react\";\r\n-import { useMutation } from \"@tanstack/react-query\";\r\n \r\n // 定义常用的图标列表\r\n const ICON_OPTIONS = [\r\n   { label: \"仪表盘\", value: \"DashboardOutlined\", icon: <DashboardOutlined /> },\r\n@@ -65,9 +69,17 @@\n   onCancel,\r\n   onSuccess,\r\n }) => {\r\n   const [form] = Form.useForm<ICreateResourceParams>();\r\n+  const [parentId, setParentId] = useState<number | null>(null);\r\n \r\n+  // 获取父级菜单信息\r\n+  const { data: parentResource } = useQuery({\r\n+    queryKey: [\"resource\", parentId],\r\n+    queryFn: () => (parentId ? getResource(parentId) : null),\r\n+    enabled: !!parentId,\r\n+  });\r\n+\r\n   // 创建资源\r\n   const createMutation = useMutation({\r\n     mutationFn: (data: ICreateResourceParams) =>\r\n       createResource({\r\n@@ -75,8 +87,9 @@\n         type: ResourceType.MENU,\r\n       }),\r\n     onSuccess: () => {\r\n       message.success(\"创建成功\");\r\n+      form.resetFields(); // 重置表单\r\n       onSuccess();\r\n     },\r\n   });\r\n \r\n@@ -88,8 +101,9 @@\n         type: ResourceType.MENU,\r\n       }),\r\n     onSuccess: () => {\r\n       message.success(\"更新成功\");\r\n+      form.resetFields(); // 重置表单\r\n       onSuccess();\r\n     },\r\n   });\r\n \r\n@@ -97,10 +111,14 @@\n   useEffect(() => {\r\n     if (visible) {\r\n       if (editingResource) {\r\n         form.setFieldsValue(editingResource);\r\n+        if (typeof editingResource.parentId === \"number\") {\r\n+          setParentId(editingResource.parentId);\r\n+        }\r\n       } else {\r\n         form.resetFields();\r\n+        setParentId(null);\r\n       }\r\n     }\r\n   }, [visible, editingResource, form]);\r\n \r\n@@ -121,13 +139,19 @@\n       console.error(\"Validate Failed:\", error);\r\n     }\r\n   };\r\n \r\n+  // 处理取消\r\n+  const handleCancel = () => {\r\n+    form.resetFields(); // 重置表单\r\n+    onCancel();\r\n+  };\r\n+\r\n   return (\r\n     <Modal\r\n       title={editingResource ? \"编辑菜单\" : \"新增菜单\"}\r\n       open={visible}\r\n-      onCancel={onCancel}\r\n+      onCancel={handleCancel}\r\n       onOk={handleSubmit}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n       <Form<ICreateResourceParams> form={form} layout=\"vertical\">\r\n@@ -155,8 +179,16 @@\n           <Input placeholder=\"请输入路由路径\" />\r\n         </Form.Item>\r\n \r\n         <Form.Item\r\n+          name=\"component\"\r\n+          label=\"组件路径\"\r\n+          rules={[{ required: true, message: \"请输入组件路径\" }]}\r\n+        >\r\n+          <Input placeholder=\"如：views/dashboard/index 或 @/views/dashboard/index\" />\r\n+        </Form.Item>\r\n+\r\n+        <Form.Item\r\n           name=\"icon\"\r\n           label=\"图标\"\r\n           rules={[{ required: true, message: \"请选择图标\" }]}\r\n         >\r\n@@ -172,20 +204,14 @@\n             )}\r\n           />\r\n         </Form.Item>\r\n \r\n-        {editingResource?.parentId ? (\r\n-          <Form.Item label=\"父级菜单\">\r\n-            <Input value={editingResource.name} disabled />\r\n-            <Form.Item name=\"parentId\" hidden>\r\n-              <Input />\r\n-            </Form.Item>\r\n+        <Form.Item label=\"父级菜单\">\r\n+          <Input value={parentResource?.name || \"无\"} disabled />\r\n+          <Form.Item name=\"parentId\" hidden>\r\n+            <Input />\r\n           </Form.Item>\r\n-        ) : (\r\n-          <Form.Item label=\"父级菜单\">\r\n-            <Input value=\"无\" disabled />\r\n-          </Form.Item>\r\n-        )}\r\n+        </Form.Item>\r\n \r\n         <Form.Item name=\"sort\" label=\"排序\">\r\n           <Input type=\"number\" placeholder=\"请输入排序\" />\r\n         </Form.Item>\r\n"
                },
                {
                    "date": 1746409205324,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,8 +70,9 @@\n   onSuccess,\r\n }) => {\r\n   const [form] = Form.useForm<ICreateResourceParams>();\r\n   const [parentId, setParentId] = useState<number | null>(null);\r\n+  const [loading, setLoading] = useState(false);\r\n \r\n   // 获取父级菜单信息\r\n   const { data: parentResource } = useQuery({\r\n     queryKey: [\"resource\", parentId],\r\n@@ -106,21 +107,32 @@\n       onSuccess();\r\n     },\r\n   });\r\n \r\n-  // 监听表单可见性变化\r\n+  // 监听表单可见性变化，编辑时实时请求数据回显\r\n   useEffect(() => {\r\n-    if (visible) {\r\n-      if (editingResource) {\r\n-        form.setFieldsValue(editingResource);\r\n-        if (typeof editingResource.parentId === \"number\") {\r\n-          setParentId(editingResource.parentId);\r\n+    const fetchAndSet = async () => {\r\n+      if (visible) {\r\n+        if (editingResource) {\r\n+          setLoading(true);\r\n+          try {\r\n+            const resource = await getResource(editingResource.id);\r\n+            form.setFieldsValue(resource);\r\n+            if (typeof resource.parentId === \"number\") {\r\n+              setParentId(resource.parentId);\r\n+            }\r\n+          } catch {\r\n+            message.error(\"获取资源数据失败，请重试\");\r\n+          } finally {\r\n+            setLoading(false);\r\n+          }\r\n+        } else {\r\n+          form.resetFields();\r\n+          setParentId(null);\r\n         }\r\n-      } else {\r\n-        form.resetFields();\r\n-        setParentId(null);\r\n       }\r\n-    }\r\n+    };\r\n+    fetchAndSet();\r\n   }, [visible, editingResource, form]);\r\n \r\n   // 处理表单提交\r\n   const handleSubmit = async () => {\r\n@@ -151,11 +163,17 @@\n       title={editingResource ? \"编辑菜单\" : \"新增菜单\"}\r\n       open={visible}\r\n       onCancel={handleCancel}\r\n       onOk={handleSubmit}\r\n-      confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n+      confirmLoading={\r\n+        createMutation.isPending || updateMutation.isPending || loading\r\n+      }\r\n     >\r\n-      <Form<ICreateResourceParams> form={form} layout=\"vertical\">\r\n+      <Form<ICreateResourceParams>\r\n+        form={form}\r\n+        layout=\"horizontal\"\r\n+        labelCol={{ span: 6 }}\r\n+      >\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"菜单名称\"\r\n           rules={[{ required: true, message: \"请输入菜单名称\" }]}\r\n"
                },
                {
                    "date": 1746409483071,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,6 @@\n import * as Icons from \"@ant-design/icons\";\r\n+\r\n import { Form, Input, Modal, Select, message } from \"antd\";\r\n import type {\r\n   ICreateResourceParams,\r\n   IResource,\r\n"
                },
                {
                    "date": 1746409489298,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,6 @@\n import * as Icons from \"@ant-design/icons\";\r\n+\r\n import { Form, Input, Modal, Select, message } from \"antd\";\r\n import type {\r\n   ICreateResourceParams,\r\n   IResource,\r\n@@ -187,8 +188,13 @@\n                 {option.data.icon}\r\n                 <span>{option.data.label}</span>\r\n               </div>\r\n             )}\r\n+            filterOption={(input, option) =>\r\n+              (option?.label as string)\r\n+                .toLowerCase()\r\n+                .includes(input.toLowerCase())\r\n+            }\r\n           />\r\n         </Form.Item>\r\n \r\n         <Form.Item label=\"父级菜单\">\r\n"
                }
            ],
            "date": 1746087949853,
            "name": "Commit-0",
            "content": "import { Form, Input, InputNumber, Modal, Select, Switch } from \"antd\";\r\nimport { createResource, updateResource } from \"@/api/modules/resource\";\r\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\r\n\r\nimport type { IResource } from \"@/types/api/resource\";\r\nimport { ResourceType } from \"@/types/api/resource\";\r\nimport { message } from \"antd\";\r\nimport { useEffect } from \"react\";\r\n\r\ninterface IResourceFormProps {\r\n  visible: boolean;\r\n  editingResource: IResource | null;\r\n  onCancel: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst ResourceForm = ({\r\n  visible,\r\n  editingResource,\r\n  onCancel,\r\n  onSuccess,\r\n}: IResourceFormProps) => {\r\n  const [form] = Form.useForm();\r\n  const queryClient = useQueryClient();\r\n\r\n  // 创建资源\r\n  const createMutation = useMutation({\r\n    mutationFn: createResource,\r\n    onSuccess: () => {\r\n      message.success(\"创建成功\");\r\n      onSuccess();\r\n    },\r\n  });\r\n\r\n  // 更新资源\r\n  const updateMutation = useMutation({\r\n    mutationFn: updateResource,\r\n    onSuccess: () => {\r\n      message.success(\"更新成功\");\r\n      onSuccess();\r\n    },\r\n  });\r\n\r\n  // 监听表单显示状态\r\n  useEffect(() => {\r\n    if (visible) {\r\n      if (editingResource) {\r\n        form.setFieldsValue(editingResource);\r\n      } else {\r\n        form.resetFields();\r\n      }\r\n    }\r\n  }, [visible, editingResource, form]);\r\n\r\n  // 处理表单提交\r\n  const handleSubmit = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      if (editingResource) {\r\n        updateMutation.mutate({\r\n          id: editingResource.id,\r\n          ...values,\r\n        });\r\n      } else {\r\n        createMutation.mutate(values);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"表单验证失败:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={editingResource ? \"编辑资源\" : \"新增资源\"}\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      onOk={handleSubmit}\r\n      confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n    >\r\n      <Form\r\n        form={form}\r\n        layout=\"vertical\"\r\n        initialValues={{ status: true }}\r\n      >\r\n        <Form.Item\r\n          name=\"name\"\r\n          label=\"资源名称\"\r\n          rules={[{ required: true, message: \"请输入资源名称\" }]}\r\n        >\r\n          <Input placeholder=\"请输入资源名称\" />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"code\"\r\n          label=\"资源编码\"\r\n          rules={[{ required: true, message: \"请输入资源编码\" }]}\r\n        >\r\n          <Input placeholder=\"请输入资源编码\" />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"type\"\r\n          label=\"资源类型\"\r\n          rules={[{ required: true, message: \"请选择资源类型\" }]}\r\n        >\r\n          <Select\r\n            placeholder=\"请选择资源类型\"\r\n            options={[\r\n              { label: \"菜单\", value: ResourceType.MENU },\r\n              { label: \"按钮\", value: ResourceType.BUTTON },\r\n              { label: \"接口\", value: ResourceType.API },\r\n            ]}\r\n          />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"path\"\r\n          label=\"资源路径\"\r\n          rules={[{ required: true, message: \"请输入资源路径\" }]}\r\n        >\r\n          <Input placeholder=\"请输入资源路径\" />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"method\"\r\n          label=\"请求方法\"\r\n          rules={[\r\n            {\r\n              required: (form) => form.getFieldValue(\"type\") === ResourceType.API,\r\n              message: \"请选择请求方法\",\r\n            },\r\n          ]}\r\n        >\r\n          <Select\r\n            placeholder=\"请选择请求方法\"\r\n            options={[\r\n              { label: \"GET\", value: \"GET\" },\r\n              { label: \"POST\", value: \"POST\" },\r\n              { label: \"PUT\", value: \"PUT\" },\r\n              { label: \"DELETE\", value: \"DELETE\" },\r\n            ]}\r\n          />\r\n        </Form.Item>\r\n\r\n        <Form.Item name=\"icon\" label=\"图标\">\r\n          <Input placeholder=\"请输入图标\" />\r\n        </Form.Item>\r\n\r\n        <Form.Item name=\"parentId\" label=\"父级资源\">\r\n          <InputNumber placeholder=\"请输入父级资源ID\" style={{ width: \"100%\" }} />\r\n        </Form.Item>\r\n\r\n        <Form.Item name=\"sort\" label=\"排序\">\r\n          <InputNumber placeholder=\"请输入排序\" style={{ width: \"100%\" }} />\r\n        </Form.Item>\r\n\r\n        <Form.Item name=\"status\" label=\"状态\" valuePropName=\"checked\">\r\n          <Switch checkedChildren=\"启用\" unCheckedChildren=\"禁用\" />\r\n        </Form.Item>\r\n      </Form>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ResourceForm; "
        }
    ]
}