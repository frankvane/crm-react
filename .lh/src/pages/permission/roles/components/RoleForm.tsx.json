{
    "sourceFile": "src/pages/permission/roles/components/RoleForm.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1746087805912,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1746088927473,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,10 @@\n import { Form, Input, Modal, Select, message } from \"antd\";\r\n-import type { ICreateRoleParams, IRole, IUpdateRoleParams } from \"@/types/api/role\";\r\n+import type {\r\n+  ICreateRoleParams,\r\n+  IRole,\r\n+  IUpdateRoleParams,\r\n+} from \"@/types/api/role\";\r\n import { createRole, updateRole } from \"@/api/modules/role\";\r\n import { useMutation, useQuery } from \"@tanstack/react-query\";\r\n \r\n import { useEffect } from \"react\";\r\n@@ -91,13 +95,9 @@\n       onOk={handleSubmit}\r\n       onCancel={onCancel}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n-      <Form\r\n-        form={form}\r\n-        layout=\"vertical\"\r\n-        initialValues={{ status: true }}\r\n-      >\r\n+      <Form form={form} layout=\"vertical\" initialValues={{ status: true }}>\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"角色名称\"\r\n           rules={[{ required: true, message: \"请输入角色名称\" }]}\r\n@@ -153,5 +153,5 @@\n     </Modal>\r\n   );\r\n };\r\n \r\n-export default RoleForm;\n\\ No newline at end of file\n+export default RoleForm;\r\n"
                },
                {
                    "date": 1746097636639,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n   editingRole,\r\n   onCancel,\r\n   onSuccess,\r\n }) => {\r\n-  const [form] = Form.useForm();\r\n+  const [form] = Form.useForm<ICreateRoleParams>();\r\n \r\n   // 获取资源列表\r\n   const { data: resourcesData } = useQuery({\r\n     queryKey: [\"resources\"],\r\n@@ -95,9 +95,13 @@\n       onOk={handleSubmit}\r\n       onCancel={onCancel}\r\n       confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n     >\r\n-      <Form form={form} layout=\"vertical\" initialValues={{ status: true }}>\r\n+      <Form<ICreateRoleParams>\r\n+        form={form}\r\n+        layout=\"vertical\"\r\n+        initialValues={{ status: 1 }}\r\n+      >\r\n         <Form.Item\r\n           name=\"name\"\r\n           label=\"角色名称\"\r\n           rules={[{ required: true, message: \"请输入角色名称\" }]}\r\n@@ -143,10 +147,10 @@\n         >\r\n           <Select\r\n             placeholder=\"请选择状态\"\r\n             options={[\r\n-              { label: \"启用\", value: true },\r\n-              { label: \"禁用\", value: false },\r\n+              { label: \"启用\", value: 1 },\r\n+              { label: \"禁用\", value: 0 },\r\n             ]}\r\n           />\r\n         </Form.Item>\r\n       </Form>\r\n"
                },
                {
                    "date": 1746098750528,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,17 +6,11 @@\n } from \"@/types/api/role\";\r\n import { createRole, updateRole } from \"@/api/modules/role\";\r\n import { useMutation, useQuery } from \"@tanstack/react-query\";\r\n \r\n+import { getResources } from \"@/api/modules/resource\";\r\n import { useEffect } from \"react\";\r\n \r\n-interface IResource {\r\n-  id: number;\r\n-  name: string;\r\n-  code: string;\r\n-  type: string;\r\n-}\r\n-\r\n interface IRoleFormProps {\r\n   visible: boolean;\r\n   editingRole: IRole | null;\r\n   onCancel: () => void;\r\n@@ -33,12 +27,9 @@\n \r\n   // 获取资源列表\r\n   const { data: resourcesData } = useQuery({\r\n     queryKey: [\"resources\"],\r\n-    queryFn: () => {\r\n-      // TODO: 实现获取资源列表的 API\r\n-      return Promise.resolve({ data: { list: [] as IResource[] } });\r\n-    },\r\n+    queryFn: () => getResources({ page: 1, pageSize: 100 }),\r\n   });\r\n \r\n   // 创建角色\r\n   const createMutation = useMutation({\r\n@@ -132,9 +123,9 @@\n         >\r\n           <Select\r\n             mode=\"multiple\"\r\n             placeholder=\"请选择资源权限\"\r\n-            options={resourcesData?.data.list.map((resource) => ({\r\n+            options={resourcesData?.list?.map((resource) => ({\r\n               label: resource.name,\r\n               value: resource.id,\r\n             }))}\r\n           />\r\n"
                }
            ],
            "date": 1746087805912,
            "name": "Commit-0",
            "content": "import { Form, Input, Modal, Select, message } from \"antd\";\r\nimport type { ICreateRoleParams, IRole, IUpdateRoleParams } from \"@/types/api/role\";\r\nimport { createRole, updateRole } from \"@/api/modules/role\";\r\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\r\n\r\nimport { useEffect } from \"react\";\r\n\r\ninterface IResource {\r\n  id: number;\r\n  name: string;\r\n  code: string;\r\n  type: string;\r\n}\r\n\r\ninterface IRoleFormProps {\r\n  visible: boolean;\r\n  editingRole: IRole | null;\r\n  onCancel: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst RoleForm: React.FC<IRoleFormProps> = ({\r\n  visible,\r\n  editingRole,\r\n  onCancel,\r\n  onSuccess,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n\r\n  // 获取资源列表\r\n  const { data: resourcesData } = useQuery({\r\n    queryKey: [\"resources\"],\r\n    queryFn: () => {\r\n      // TODO: 实现获取资源列表的 API\r\n      return Promise.resolve({ data: { list: [] as IResource[] } });\r\n    },\r\n  });\r\n\r\n  // 创建角色\r\n  const createMutation = useMutation({\r\n    mutationFn: (data: ICreateRoleParams) => createRole(data),\r\n    onSuccess: () => {\r\n      message.success(\"创建成功\");\r\n      onSuccess();\r\n    },\r\n  });\r\n\r\n  // 更新角色\r\n  const updateMutation = useMutation({\r\n    mutationFn: ({ id, data }: { id: number; data: IUpdateRoleParams }) =>\r\n      updateRole(id, data),\r\n    onSuccess: () => {\r\n      message.success(\"更新成功\");\r\n      onSuccess();\r\n    },\r\n  });\r\n\r\n  // 监听表单可见性变化\r\n  useEffect(() => {\r\n    if (visible) {\r\n      if (editingRole) {\r\n        form.setFieldsValue(editingRole);\r\n      } else {\r\n        form.resetFields();\r\n      }\r\n    }\r\n  }, [visible, editingRole, form]);\r\n\r\n  // 处理表单提交\r\n  const handleSubmit = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      if (editingRole) {\r\n        updateMutation.mutate({\r\n          id: editingRole.id,\r\n          data: values,\r\n        });\r\n      } else {\r\n        createMutation.mutate(values);\r\n      }\r\n    } catch (error) {\r\n      // 表单验证失败\r\n      console.error(\"Validate Failed:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={editingRole ? \"编辑角色\" : \"新增角色\"}\r\n      open={visible}\r\n      onOk={handleSubmit}\r\n      onCancel={onCancel}\r\n      confirmLoading={createMutation.isPending || updateMutation.isPending}\r\n    >\r\n      <Form\r\n        form={form}\r\n        layout=\"vertical\"\r\n        initialValues={{ status: true }}\r\n      >\r\n        <Form.Item\r\n          name=\"name\"\r\n          label=\"角色名称\"\r\n          rules={[{ required: true, message: \"请输入角色名称\" }]}\r\n        >\r\n          <Input placeholder=\"请输入角色名称\" />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"code\"\r\n          label=\"角色编码\"\r\n          rules={[{ required: true, message: \"请输入角色编码\" }]}\r\n        >\r\n          <Input placeholder=\"请输入角色编码\" />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"description\"\r\n          label=\"描述\"\r\n          rules={[{ required: true, message: \"请输入描述\" }]}\r\n        >\r\n          <Input.TextArea placeholder=\"请输入描述\" rows={4} />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"resourceIds\"\r\n          label=\"资源权限\"\r\n          rules={[{ required: true, message: \"请选择资源权限\" }]}\r\n        >\r\n          <Select\r\n            mode=\"multiple\"\r\n            placeholder=\"请选择资源权限\"\r\n            options={resourcesData?.data.list.map((resource) => ({\r\n              label: resource.name,\r\n              value: resource.id,\r\n            }))}\r\n          />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          name=\"status\"\r\n          label=\"状态\"\r\n          rules={[{ required: true, message: \"请选择状态\" }]}\r\n        >\r\n          <Select\r\n            placeholder=\"请选择状态\"\r\n            options={[\r\n              { label: \"启用\", value: true },\r\n              { label: \"禁用\", value: false },\r\n            ]}\r\n          />\r\n        </Form.Item>\r\n      </Form>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default RoleForm;"
        }
    ]
}