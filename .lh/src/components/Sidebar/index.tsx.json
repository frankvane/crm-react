{
    "sourceFile": "src/components/Sidebar/index.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1746088401865,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1746088839987,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,15 +35,22 @@\n           key: \"/permission/resources\",\r\n           icon: <UnorderedListOutlined />,\r\n           label: \"资源管理\",\r\n         },\r\n+      ],\r\n+    },\r\n+    {\r\n+      key: \"category\",\r\n+      icon: <TagOutlined />,\r\n+      label: \"分类管理\",\r\n+      children: [\r\n         {\r\n-          key: \"/permission/category-types\",\r\n-          icon: <TagOutlined />,\r\n+          key: \"/category/category-types\",\r\n+          icon: <AppstoreOutlined />,\r\n           label: \"分类类型管理\",\r\n         },\r\n         {\r\n-          key: \"/permission/categories\",\r\n+          key: \"/category/categories\",\r\n           icon: <UnorderedListOutlined />,\r\n           label: \"分类管理\",\r\n         },\r\n       ],\r\n"
                },
                {
                    "date": 1746088927337,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,5 +77,5 @@\n     </div>\r\n   );\r\n };\r\n \r\n-export default Sidebar; \n\\ No newline at end of file\n+export default Sidebar;\r\n"
                },
                {
                    "date": 1746090362924,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,16 +3,23 @@\n   DashboardOutlined,\r\n   KeyOutlined,\r\n   TagOutlined,\r\n   UnorderedListOutlined,\r\n+  UserOutlined,\r\n } from \"@ant-design/icons\";\r\n+import { Layout, Menu } from \"antd\";\r\n import { useLocation, useNavigate } from \"react-router-dom\";\r\n \r\n-import { Menu } from \"antd\";\r\n import type { MenuProps } from \"antd\";\r\n import styles from \"./style.module.less\";\r\n \r\n-const Sidebar = () => {\r\n+const { Sider } = Layout;\r\n+\r\n+interface SidebarProps {\r\n+  collapsed: boolean;\r\n+}\r\n+\r\n+const Sidebar = ({ collapsed }: SidebarProps) => {\r\n   const navigate = useNavigate();\r\n   const location = useLocation();\r\n \r\n   const menuItems: MenuProps[\"items\"] = [\r\n@@ -35,8 +42,13 @@\n           key: \"/permission/resources\",\r\n           icon: <UnorderedListOutlined />,\r\n           label: \"资源管理\",\r\n         },\r\n+        {\r\n+          key: \"/permission/users\",\r\n+          icon: <UserOutlined />,\r\n+          label: \"用户管理\",\r\n+        },\r\n       ],\r\n     },\r\n     {\r\n       key: \"category\",\r\n@@ -61,21 +73,27 @@\n     navigate(key);\r\n   };\r\n \r\n   return (\r\n-    <div className={styles.sidebar}>\r\n+    <Sider\r\n+      className={styles.sidebar}\r\n+      width={200}\r\n+      collapsed={collapsed}\r\n+      collapsible\r\n+      trigger={null}\r\n+    >\r\n       <div className={styles.logo}>\r\n-        <h1>CRM Admin</h1>\r\n+        <h1>{collapsed ? \"CRM\" : \"CRM Admin\"}</h1>\r\n       </div>\r\n       <Menu\r\n         theme=\"dark\"\r\n         mode=\"inline\"\r\n         selectedKeys={[location.pathname]}\r\n-        defaultOpenKeys={[\"permission\"]}\r\n+        defaultOpenKeys={[\"permission\", \"category\"]}\r\n         items={menuItems}\r\n         onClick={handleMenuClick}\r\n       />\r\n-    </div>\r\n+    </Sider>\r\n   );\r\n };\r\n \r\n export default Sidebar;\r\n"
                },
                {
                    "date": 1746090721100,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n   const location = useLocation();\r\n \r\n   const menuItems: MenuProps[\"items\"] = [\r\n     {\r\n-      key: \"/dashboard\",\r\n+      key: \"/app/dashboard\",\r\n       icon: <DashboardOutlined />,\r\n       label: \"仪表盘\",\r\n     },\r\n     {\r\n@@ -33,19 +33,19 @@\n       icon: <KeyOutlined />,\r\n       label: \"权限管理\",\r\n       children: [\r\n         {\r\n-          key: \"/permission/roles\",\r\n+          key: \"/app/permission/roles\",\r\n           icon: <AppstoreOutlined />,\r\n           label: \"角色管理\",\r\n         },\r\n         {\r\n-          key: \"/permission/resources\",\r\n+          key: \"/app/permission/resources\",\r\n           icon: <UnorderedListOutlined />,\r\n           label: \"资源管理\",\r\n         },\r\n         {\r\n-          key: \"/permission/users\",\r\n+          key: \"/app/permission/users\",\r\n           icon: <UserOutlined />,\r\n           label: \"用户管理\",\r\n         },\r\n       ],\r\n@@ -55,14 +55,14 @@\n       icon: <TagOutlined />,\r\n       label: \"分类管理\",\r\n       children: [\r\n         {\r\n-          key: \"/category/category-types\",\r\n+          key: \"/app/category/category-types\",\r\n           icon: <AppstoreOutlined />,\r\n           label: \"分类类型管理\",\r\n         },\r\n         {\r\n-          key: \"/category/categories\",\r\n+          key: \"/app/category/categories\",\r\n           icon: <UnorderedListOutlined />,\r\n           label: \"分类管理\",\r\n         },\r\n       ],\r\n"
                },
                {
                    "date": 1746227933515,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,79 +1,67 @@\n-import {\r\n-  AppstoreOutlined,\r\n-  DashboardOutlined,\r\n-  KeyOutlined,\r\n-  TagOutlined,\r\n-  UnorderedListOutlined,\r\n-  UserOutlined,\r\n-} from \"@ant-design/icons\";\r\n+import * as Icons from \"@ant-design/icons\";\r\n+\r\n import { Layout, Menu } from \"antd\";\r\n import { useLocation, useNavigate } from \"react-router-dom\";\r\n \r\n-import type { MenuProps } from \"antd\";\r\n+import { ReactNode } from \"react\";\r\n import styles from \"./style.module.less\";\r\n+import { useAuthStore } from \"@/store/modules/auth\";\r\n \r\n const { Sider } = Layout;\r\n \r\n interface SidebarProps {\r\n   collapsed: boolean;\r\n }\r\n \r\n+// 动态获取 icon 组件\r\n+function getIconByName(name?: string): ReactNode {\r\n+  if (!name) return null;\r\n+  const IconComponent = (Icons as any)[name];\r\n+  return IconComponent ? <IconComponent /> : null;\r\n+}\r\n+\r\n+function buildMenuItems(resources: any[], parentPath = \"/app\"): any[] {\r\n+  return (resources || [])\r\n+    .filter((item: any) => item.type === \"menu\")\r\n+    .map((item: any) => {\r\n+      const fullPath = item.path.startsWith(\"/\")\r\n+        ? item.path\r\n+        : `${parentPath}/${item.path}`;\r\n+      return {\r\n+        key: fullPath,\r\n+        icon: getIconByName(item.icon),\r\n+        label: item.name,\r\n+        children: item.children\r\n+          ? buildMenuItems(item.children, fullPath)\r\n+          : undefined,\r\n+      };\r\n+    });\r\n+}\r\n+\r\n const Sidebar = ({ collapsed }: SidebarProps) => {\r\n   const navigate = useNavigate();\r\n   const location = useLocation();\r\n+  const resources = useAuthStore((state) => state.resources);\r\n \r\n-  const menuItems: MenuProps[\"items\"] = [\r\n-    {\r\n-      key: \"/app/dashboard\",\r\n-      icon: <DashboardOutlined />,\r\n-      label: \"仪表盘\",\r\n-    },\r\n-    {\r\n-      key: \"permission\",\r\n-      icon: <KeyOutlined />,\r\n-      label: \"权限管理\",\r\n-      children: [\r\n-        {\r\n-          key: \"/app/permission/roles\",\r\n-          icon: <AppstoreOutlined />,\r\n-          label: \"角色管理\",\r\n-        },\r\n-        {\r\n-          key: \"/app/permission/resources\",\r\n-          icon: <UnorderedListOutlined />,\r\n-          label: \"资源管理\",\r\n-        },\r\n-        {\r\n-          key: \"/app/permission/users\",\r\n-          icon: <UserOutlined />,\r\n-          label: \"用户管理\",\r\n-        },\r\n-      ],\r\n-    },\r\n-    {\r\n-      key: \"category\",\r\n-      icon: <TagOutlined />,\r\n-      label: \"分类管理\",\r\n-      children: [\r\n-        {\r\n-          key: \"/app/category/category-types\",\r\n-          icon: <AppstoreOutlined />,\r\n-          label: \"分类类型管理\",\r\n-        },\r\n-        {\r\n-          key: \"/app/category/categories\",\r\n-          icon: <UnorderedListOutlined />,\r\n-          label: \"分类管理\",\r\n-        },\r\n-      ],\r\n-    },\r\n-  ];\r\n+  const menuItems = buildMenuItems(resources || []);\r\n \r\n-  const handleMenuClick: MenuProps[\"onClick\"] = ({ key }) => {\r\n+  const handleMenuClick = ({ key }: { key: string }) => {\r\n     navigate(key);\r\n   };\r\n \r\n+  // 展开所有父级菜单\r\n+  const getOpenKeys = (pathname: string) => {\r\n+    const parts = pathname.split(\"/\").filter(Boolean);\r\n+    const keys: string[] = [];\r\n+    let current = \"\";\r\n+    for (const part of parts) {\r\n+      current += \"/\" + part;\r\n+      keys.push(current);\r\n+    }\r\n+    return keys;\r\n+  };\r\n+\r\n   return (\r\n     <Sider\r\n       className={styles.sidebar}\r\n       width={200}\r\n@@ -87,9 +75,9 @@\n       <Menu\r\n         theme=\"dark\"\r\n         mode=\"inline\"\r\n         selectedKeys={[location.pathname]}\r\n-        defaultOpenKeys={[\"permission\", \"category\"]}\r\n+        defaultOpenKeys={getOpenKeys(location.pathname)}\r\n         items={menuItems}\r\n         onClick={handleMenuClick}\r\n       />\r\n     </Sider>\r\n"
                },
                {
                    "date": 1746228182700,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,15 +26,16 @@\n     .map((item: any) => {\r\n       const fullPath = item.path.startsWith(\"/\")\r\n         ? item.path\r\n         : `${parentPath}/${item.path}`;\r\n+      const children = item.children\r\n+        ? buildMenuItems(item.children, fullPath)\r\n+        : undefined;\r\n       return {\r\n         key: fullPath,\r\n         icon: getIconByName(item.icon),\r\n         label: item.name,\r\n-        children: item.children\r\n-          ? buildMenuItems(item.children, fullPath)\r\n-          : undefined,\r\n+        ...(children && children.length > 0 ? { children } : {}),\r\n       };\r\n     });\r\n }\r\n \r\n"
                },
                {
                    "date": 1746229176915,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,9 @@\n }\r\n \r\n function buildMenuItems(resources: any[], parentPath = \"/app\"): any[] {\r\n   return (resources || [])\r\n-    .filter((item: any) => item.type === \"menu\")\r\n+    .filter((item: any) => item.type.toLowerCase() === \"menu\")\r\n     .map((item: any) => {\r\n       const fullPath = item.path.startsWith(\"/\")\r\n         ? item.path\r\n         : `${parentPath}/${item.path}`;\r\n"
                },
                {
                    "date": 1746244551260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,15 +62,9 @@\n     return keys;\r\n   };\r\n \r\n   return (\r\n-    <Sider\r\n-      className={styles.sidebar}\r\n-      width={200}\r\n-      collapsed={collapsed}\r\n-      collapsible\r\n-      trigger={null}\r\n-    >\r\n+    <Sider width={200} collapsed={collapsed} collapsible trigger={null}>\r\n       <div className={styles.logo}>\r\n         <h1>{collapsed ? \"CRM\" : \"CRM Admin\"}</h1>\r\n       </div>\r\n       <Menu\r\n"
                }
            ],
            "date": 1746088401865,
            "name": "Commit-0",
            "content": "import {\r\n  AppstoreOutlined,\r\n  DashboardOutlined,\r\n  KeyOutlined,\r\n  TagOutlined,\r\n  UnorderedListOutlined,\r\n} from \"@ant-design/icons\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\n\r\nimport { Menu } from \"antd\";\r\nimport type { MenuProps } from \"antd\";\r\nimport styles from \"./style.module.less\";\r\n\r\nconst Sidebar = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const menuItems: MenuProps[\"items\"] = [\r\n    {\r\n      key: \"/dashboard\",\r\n      icon: <DashboardOutlined />,\r\n      label: \"仪表盘\",\r\n    },\r\n    {\r\n      key: \"permission\",\r\n      icon: <KeyOutlined />,\r\n      label: \"权限管理\",\r\n      children: [\r\n        {\r\n          key: \"/permission/roles\",\r\n          icon: <AppstoreOutlined />,\r\n          label: \"角色管理\",\r\n        },\r\n        {\r\n          key: \"/permission/resources\",\r\n          icon: <UnorderedListOutlined />,\r\n          label: \"资源管理\",\r\n        },\r\n        {\r\n          key: \"/permission/category-types\",\r\n          icon: <TagOutlined />,\r\n          label: \"分类类型管理\",\r\n        },\r\n        {\r\n          key: \"/permission/categories\",\r\n          icon: <UnorderedListOutlined />,\r\n          label: \"分类管理\",\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  const handleMenuClick: MenuProps[\"onClick\"] = ({ key }) => {\r\n    navigate(key);\r\n  };\r\n\r\n  return (\r\n    <div className={styles.sidebar}>\r\n      <div className={styles.logo}>\r\n        <h1>CRM Admin</h1>\r\n      </div>\r\n      <Menu\r\n        theme=\"dark\"\r\n        mode=\"inline\"\r\n        selectedKeys={[location.pathname]}\r\n        defaultOpenKeys={[\"permission\"]}\r\n        items={menuItems}\r\n        onClick={handleMenuClick}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Sidebar; "
        }
    ]
}